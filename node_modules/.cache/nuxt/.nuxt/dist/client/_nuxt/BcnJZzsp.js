import{H as i,n as c}from"./CvK9njM3.js";import{u as d}from"./B0FIwMiM.js";class n extends Error{}n.prototype.name="InvalidTokenError";function l(r){return decodeURIComponent(atob(r).replace(/(.)/g,(e,t)=>{let o=t.charCodeAt(0).toString(16).toUpperCase();return o.length<2&&(o="0"+o),"%"+o}))}function p(r){let e=r.replace(/-/g,"+").replace(/_/g,"/");switch(e.length%4){case 0:break;case 2:e+="==";break;case 3:e+="=";break;default:throw new Error("base64 string is not of the correct length")}try{return l(e)}catch{return atob(e)}}function u(r,e){if(typeof r!="string")throw new n("Invalid token specified: must be a string");e||(e={});const t=e.header===!0?0:1,o=r.split(".")[t];if(typeof o!="string")throw new n(`Invalid token specified: missing part #${t+1}`);let s;try{s=p(o)}catch(a){throw new n(`Invalid token specified: invalid base64 for part #${t+1} (${a.message})`)}try{return JSON.parse(s)}catch(a){throw new n(`Invalid token specified: invalid json for part #${t+1} (${a.message})`)}}const D=i(r=>{const e=d("accessToken");if(!e.value)return console.log("[ADMIN MIDDLEWARE] Нет токена, редирект на /"),c("/");try{const t=u(e.value);if(console.log("[ADMIN MIDDLEWARE] Декодированный токен:",t),t.role!=="ADMIN")return console.log("[ADMIN MIDDLEWARE] Роль не ADMIN, редирект на /"),c("/")}catch(t){return console.error("[ADMIN MIDDLEWARE] Ошибка парсинга токена:",t),c("/")}});export{D as default};
